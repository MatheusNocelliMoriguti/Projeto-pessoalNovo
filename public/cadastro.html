<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fómula 1</title>
    <script src="./js/sessao.js"></script>
    <script src="./JavaScriptGlobal.js"></script>
    <script src="./js/cadastro.js"></script>
    <link rel="stylesheet" href="./css/style login e cadastro.css" />
    <link rel="shortcut icon" href="./assets/imgs/logo.png" type="image/x-icon">
    
    <link rel="preconnect" href="https://fonts.gstatic.com" />
  </head>
  
  <body>
    <div class="header">
      <div class="container">
        <h1 class="titulo">
          <img src="./assets/imgs/logo.png" />
        </h1>
        <ul class="navbar navbar-elementos">
          <li><a class="loginA" href="login.html">LOGIN</a></li>
          
            <button onclick="home()" class="botao">
              <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="#ffff" class="bi bi-house-fill" viewBox="0 0 16 16" >
                <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L8 2.207l6.646 6.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293z" />
                <path d="m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293z"/>
              </svg>
            </button>
          
        </ul>
      </div>
    </div>
   
    <div class="main-content">
      <div class="container">
          <div class=" main-content card card-cadastro">
            <div class="formulario">
              <h2>Cadastre-se</h2>
              <div class="campo">
                <span>Nome :</span>
                <input id="input_nome" class="iptCampos" placeholder="Insira aqui seu nome" />
                <div id="divvalidarNome" style="color: rgb(255,182,193)"></div>
              </div>
              <div class="campo">
                <span>Email (usuário):</span>
                <input id="input_email" class="iptCampos" placeholder="Seu email" />
                <div id="divvalidarEmail" style="color: rgb(255,182,193)"></div>
              </div>
             
             
              <div class="campo">
                <span>Senha:</span>
                <div id="senha"> 
                  <input id="input_senha" type="password" placeholder="******">
                
                </div>
                <div id="divvalidarSenha" style="color: rgb(255,182,193)"></div>
              </div>
              <div class="campo">
                <span>Confirmação da Senha:</span>
                <input id="input_confirmacao_senha" class="iptCampos" type="password" placeholder="******" />
                <div id="divvalidarSenha2" style="color: rgb(255,182,193)"></div>
              </div>
              <div class="campo">
                <span>Equipe:</span>
                <input id="input_equipe" class="iptCampos" placeholder="Insira sua Equipe" />
                <div id="divvalidarEquipe" style="color: rgb(255,182,193)"></div>
              </div>
              <button onclick="cadastrar()" id="botao">Cadastrar</button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="footer">
      <div class="container">
        <h4>&copy; 2024 Fórmula 1. v1.0.0.</h4>
      </div>
    </div>

  </body>
</html>


<script>

  // Array para armazenar empresas cadastradas para validação de código de ativação 
  let listaEmpresasCadastradas = [];
  function home() {
    window.location.href = "./index.html";
  }
  
  var nomeValidado = false
    var emailValidado = false
    var senhaValidado = false
    var confirmacaoValidado = false
    var equipeValidado = false

  function cadastrar() {


    // aguardar();

    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    var nomeVar = input_nome.value;
    var emailVar = input_email.value;
    var senhaVar = input_senha.value;
    var confirmacaoSenhaVar = input_confirmacao_senha.value;
    var equipeVar = input_equipe.value;
    // var codigoVar = codigo_input.value;
    // var idEmpresaVincular

    // Verificando se há algum campo em branco
    if(nomeValidado == false || emailValidado == false ||  senhaValidado == false || confirmacaoValidado == false || equipeValidado == false){



//validar nome

  if(nomeVar.length > 0){
      divvalidarNome.innerHTML = `✅`;
      nomeValidado = true

  } else {
      divvalidarNome.innerHTML = ` Insira um nome válido `;
      nomeValidado = false
  }


  //validação do email

  if (emailVar.includes("@")) {
      divvalidarEmail.innerHTML = `✅`
      emailValidado = true

  } else {
      divvalidarEmail.innerHTML = ` Insira um email válido `
      emailValidado = false
  }
  

//variaveis pro if e for da senha

var temNumero = false;
var temNumeroCorreto = ``
var temLetram = false;
var temLetramCorreto= ``;
var temLetraM = false;
var temLetraMCorreto= ``;

if (senhaVar.length >= 8){
  
  for (var atual = 0; atual < senhaVar.length; atual++) {
     
      var atual2 = senhaVar[atual];
      
      if(atual2 >= 'A' && atual2 <= 'Z') {
          temLetraM = true;
          temLetraMCorreto = `✅`

      } else if (atual2 >= 'a' && atual2 <= 'z') {
          temLetram = true;
          temLetramCorreto = `✅`

      } else if (atual2 >= '0' && atual2 <= '9') { 
          temNumero = true;
          temNumeroCorreto = `✅`

      }
  }

  if (temLetraM && temLetram && temNumero) {
      divvalidarSenha.innerHTML = `✅`;
      senhaValidado = true

  } else {
      divvalidarSenha.innerHTML = `
         Senha deve conter ao menos 8 caracteres válidos:<br>
        ${temLetraMCorreto} Letra(s) Maiúscula(s), ${temLetramCorreto} minúsculas(s), ${temNumeroCorreto}número(s)`;
        senhaValidado = false
  }
} else {
divvalidarSenha.innerHTML = ` Senha deve ter pelo menos 8 caracteres.`;
}


//confirmação da senha

if(confirmacaoSenhaVar.length >= 8) {
  if(confirmacaoSenhaVar == senhaVar) {
  
      divvalidarSenha2.innerHTML = `✅`;
      confirmacaoValidado = true

  } else {
  
      divvalidarSenha2.innerHTML = `  Senhas diferentes`; 
      confirmacaoValidado = false
  }
} else {
  
  divvalidarSenha2.innerHTML = ` Insira algo válido`;
  confirmacaoValidado = false
  } 

  if(nomeValidado && emailValidado &&  senhaValidado && confirmacaoValidado && equipeValidado){
      botao.innerHTML = `Logar`

      input_nome.readOnly = true
      input_email.readOnly = true
      input_senha.readOnly = true
      input_confirmacao_senha.readOnly = true
      input_equipe.readOnly = true
     
  }

} else {
  window.location.href = "./login.html"
}


 // validação equipe
 if(equipeVar.includes('Mercedes') || equipeVar.includes('Mclaren') || equipeVar.includes('Ferrari') || equipeVar.includes('RedBull')){
  divvalidarEquipe.innerHTML = `✅`;
  equipeValidado = true

} else {
  divvalidarEquipe.innerHTML = ` Insira uma Equipe válida `;
  equipeValidadoValidado = false
}

if (nomeValidado && emailValidado && senhaValidado && confirmacaoValidado && equipeValidado) {
alert("Cadastro concluído com sucesso!");

  
}



    // } else {
    //   setInterval(sumirMensagem, 5000);
    // }

    // Verificando se o código de ativação é de alguma empresa cadastrada
    // for (let i = 0; i < listaEmpresasCadastradas.length; i++) {
    //   if (listaEmpresasCadastradas[i].codigo_ativacao == codigoVar) {
    //     idEmpresaVincular = listaEmpresasCadastradas[i].id
    //     console.log("Código de ativação válido.");
    //     break;
    //   } else {
    //     // cardErro.style.display = "block";
    //     mensagem_erro.innerHTML = "(Mensagem de erro para código inválido)";
    //     finalizarAguardar();
    //   }
    // }

    // Enviando o valor da nova input
    fetch("/usuarios/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        nomeServer: nomeVar,
        emailServer: emailVar,
        senhaServer: senhaVar,
        equipeServer: equipeVar
        // idEmpresaVincularServer: idEmpresaVincular
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
          // cardErro.style.display = "block";

          // mensagem_erro.innerHTML =
          //   "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

          setTimeout(() => {
            window.location = "login.html";
          }, "2000");

          // limparFormulario();
          // finalizarAguardar();
        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        // finalizarAguardar();
      });

    return false;
    }
    
    
</script>